var E=class{scrollToPositionThreshold;scrollSpeed;startTime;scrollAnimationState;actualScrollAction;constructor(t=100,i=50){this.scrollToPositionThreshold=i,this.scrollSpeed=t,this.startTime=null,this.scrollAnimationState=null,this.actualScrollAction=null}shouldEnableAutoScroller(t,i){let e=Math.max(document.documentElement.clientWidth||0,window.innerWidth||0),r=Math.max(document.documentElement.clientHeight||0,window.innerHeight||0),s=document.elementFromPoint(t,i);if(s){let n=s.getBoundingClientRect();t>e-this.scrollToPositionThreshold?this.getLastScrollableElementOnAxis("x","f",s,1):t-n.x>s.clientWidth-this.scrollToPositionThreshold?this.scrollElement("x","f",this.getFirstFullyVisibleElementOnAxis("x",s),2):t<this.scrollToPositionThreshold?this.getLastScrollableElementOnAxis("x","b",s,3):t-n.x<this.scrollToPositionThreshold?this.scrollElement("x","b",this.getFirstFullyVisibleElementOnAxis("x",s),4):i<this.scrollToPositionThreshold?this.getLastScrollableElementOnAxis("y","b",s,5):i-n.y<this.scrollToPositionThreshold?this.scrollElement("y","b",this.getFirstFullyVisibleElementOnAxis("y",s),6):i>r-this.scrollToPositionThreshold?this.getLastScrollableElementOnAxis("y","f",s,7):i-n.y>n.height-this.scrollToPositionThreshold?this.scrollElement("y","b",this.getFirstFullyVisibleElementOnAxis("y",s),8):this.stopScroller()}}getLastScrollableElementOnAxis(t,i,e,r){if(r!==this.actualScrollAction){this.stopScroller(),this.actualScrollAction=r;let s;for(;e;)this.isScrollable(t,e)&&!this.isScrolledToEnd(t,i,e)&&(s=e),e=e.parentElement;s&&this.startScroller(t,i,s)}}scrollElement(t,i,e,r){r!==this.actualScrollAction&&(this.stopScroller(),this.actualScrollAction=r,this.startScroller(t,i,e))}isScrollable(t,i){return getComputedStyle(i).overflow.includes("hidden")?!1:t==="x"?i.scrollWidth>i.clientWidth:i.scrollHeight>i.clientHeight}isScrolledToEnd=(t,i,e)=>t==="x"&&i==="f"?e.scrollWidth-e.scrollLeft<=e.clientWidth+1:t==="x"&&i==="b"?e.scrollLeft===0:t==="y"&&i==="f"?e.scrollHeight-e.scrollTop<=e.clientHeight+1:t==="y"&&i==="b"?e.scrollTop===0:!1;startScroller(t,i,e,r=0){this.scrollAnimationState===null&&(this.scrollAnimationState=requestAnimationFrame(s=>{this.startTime||(this.startTime=s);let n=s-this.startTime;this.startTime=s,r+=n/1e3*this.scrollSpeed,r>1&&(r=i==="f"?r:-r,t==="y"?e?.scrollBy({left:0,top:r,behavior:"instant"}):t==="x"&&e?.scrollBy({left:r,top:0,behavior:"instant"}),r=0),this.scrollAnimationState=null,this.startScroller(t,i,e,r)}))}isFullyVisibleOnAxis(t,i,e){return t==="x"?i.clientWidth<e.clientWidth:i.clientHeight<e.clientHeight}getFirstFullyVisibleElementOnAxis(t,i){let e=i.parentElement;for(;e;){if(this.isFullyVisibleOnAxis(t,i,e))return i;i=e,e=e.parentElement}return i}stopScroller(){this.scrollAnimationState&&cancelAnimationFrame(this.scrollAnimationState),this.startTime=null,this.scrollAnimationState=null,this.actualScrollAction=null}};var v=(m,t)=>{let i=m;for(;i;){if(i instanceof HTMLElement&&t(i))return i;i=i.parentElement}return null};var b=(m,t,i)=>(t>i&&([t,i]=[i,t]),m.slice(t,i+1));var g=m=>{let t=m.getBoundingClientRect();return{x:t.left,y:t.top,w:t.width,h:t.height}},f=(m,t)=>{let i=t.split(/\s+/).filter(Boolean);m.classList.add(...i)},L=(m,t)=>{let i=t.split(/\s+/).filter(Boolean);m.classList.remove(...i)};var p=class{animationDuration;oldPositionAttribute;animationAttribute;isMovedAttribute;ignoreAttribute;constructor(t=500,i="data-el-ignore",e="data-el-animation-att",r="data-el-moved-att",s="data-el-old-pos"){this.animationDuration=t,this.oldPositionAttribute=s,this.animationAttribute=e,this.isMovedAttribute=r,this.ignoreAttribute=i}isMoved(...t){let i=!1;return t.forEach(e=>{e.hasAttribute(this.isMovedAttribute)&&(i=!0)}),i}removeAnimation=t=>{t.style.transition="",t.style.transform=""};saveElementPosition=(t,i)=>(t.setAttribute(this.oldPositionAttribute,JSON.stringify(i)),t);moveToSavedPosition=t=>{let i=g(t),e=JSON.parse(t.getAttribute(this.oldPositionAttribute));t.style.transform=`translate3d(${e.x-i.x}px, ${e.y-i.y}px, 0px)`};animate=(t,i=0,e=0,r)=>{if(t.setAttribute(this.isMovedAttribute,""),t.style.transition=`transform ${this.animationDuration}ms ease`,t.style.transform=`translate3d(${i}px, ${e}px, 0px)`,t.hasAttribute(this.animationAttribute)){let n=Number(t.getAttribute(this.animationAttribute));clearTimeout(n)}let s=setTimeout(()=>{this.removeAnimation(t),t.removeAttribute(this.oldPositionAttribute),t.removeAttribute(this.isMovedAttribute),t.removeAttribute(this.animationAttribute),r?.()},this.animationDuration);t.setAttribute(this.animationAttribute,String(s))};animateElementsMovement=(t,i)=>{t.forEach(e=>{this.saveElementPosition(e,g(e)),e.hasAttribute(this.ignoreAttribute)||(this.saveElementPosition(e,g(e)),this.removeAnimation(e))}),i(),t.forEach(e=>{e.setAttribute(this.isMovedAttribute,""),this.moveToSavedPosition(e),e.offsetHeight,this.animate(e)})}};var y=()=>{let m={};return{on:(e,r)=>{m[e]||(m[e]=[]),m[e].push(r)},emit:(e,r)=>{let s=m[e];s&&s.forEach(n=>n(r))}}};var T=class{options;animationDuration;draggedElementStyle;draggedElementClass;previewElementStyle;previewElementClass;draggedElement;draggedElementOriginalIndex;draggedElementPosition;originalStyle;previewElement;previewElementList;previewElementOriginalList;enteredTarget;draggedElementAttribute;previewElementAttribute;previewElementOriginalListAttribute;previewElementListSharedAttribute;previewElementDestinationPositionAttribute;listSharedAttribute;listAttribute;listHasActionBtnAttribute;listItemActionBtnAttribute;listDragDisabledAttribute;listDropDisabledAttribute;listItemAttribute;listIdAttribute;autoScroller;ignoreElementAttribute;elementsAnimator;elementsWithListeners;on;emit;constructor(t){this.animationDuration=t.animationDuration??150,this.previewElementStyle=t.previewElementStyle??null,this.previewElementClass=t.previewElementClass??"",this.draggedElementStyle=t.draggedElementStyle??null,this.draggedElementClass=t.draggedElementClass??"",this.previewElement=null,this.previewElementList=null,this.previewElementOriginalList=null,this.draggedElement=null,this.draggedElementOriginalIndex=null,this.draggedElementPosition={x:0,y:0,offsetX:0,offsetY:0,directionY:0,directionX:0},this.originalStyle="",this.enteredTarget=null,this.draggedElementAttribute="data-dragging",this.previewElementAttribute="data-preview",this.previewElementOriginalListAttribute="data-prev-orig-list",this.previewElementListSharedAttribute="data-prev-list-shared",this.previewElementDestinationPositionAttribute="data-prev-destination-position",this.listSharedAttribute="data-list-shared",this.listAttribute="data-list",this.listHasActionBtnAttribute="data-list-has-action-btn",this.listDragDisabledAttribute="data-list-drop-disabled",this.listDropDisabledAttribute="data-list-drag-disabled",this.listItemAttribute="data-list-item",this.listIdAttribute="data-list-id",this.listItemActionBtnAttribute="data-list-item-action-btn",this.autoScroller=new E(500,50),this.ignoreElementAttribute="data-el-ignore",this.elementsAnimator=new p(this.animationDuration,this.ignoreElementAttribute),Object.assign(this,y()),this.elementsWithListeners=[],this.init()}init=()=>{let t=n=>this.onDragStart(n,n.clientX,n.clientY);document.addEventListener("mousedown",t);let i=n=>this.onDragStart(n,n.touches[0].clientX,n.touches[0].clientY);document.addEventListener("touchstart",i,{passive:!1});let e=()=>this.onDragEnd();document.addEventListener("mouseup",e),document.addEventListener("touchend",e);let r=n=>this.onDragMove(n,n.target,n.clientX,n.clientY);document.addEventListener("mousemove",r,{passive:!1});let s=n=>this.onDragMove(n,document.elementFromPoint(n.touches[0].clientX,n.touches[0].clientY),n.touches[0].clientX,n.touches[0].clientY);document.addEventListener("touchmove",s,{passive:!1}),this.elementsWithListeners.push({el:document,events:{mousedown:t,touchstart:i,mouseup:e,touchend:e,mousemove:r,onTouchmove:s}})};clearEventListeners=()=>{this.elementsWithListeners.forEach(t=>{for(let[i,e]of Object.entries(t.events))t.el.removeEventListener(i,e)})};onDragStart(t,i,e){let r=t.target;if(!(t instanceof MouseEvent&&t.button!==0)&&!this.draggedElement&&r instanceof HTMLElement){let s=v(r,l=>l.hasAttribute(this.listItemAttribute)&&l.hasAttribute(this.listIdAttribute)),n=this.searchList(String(s?.getAttribute(this.listIdAttribute)));s&&n&&(!n.hasAttribute(this.listHasActionBtnAttribute)||r.hasAttribute(this.listItemActionBtnAttribute))&&(t.preventDefault(),!this.elementsAnimator.isMoved(s)&&!n.hasAttribute(this.listDragDisabledAttribute)&&s.parentElement&&(this.previewElement=this.createPreviewElement(n,s),this.draggedElement=this.createDraggedElement(n,s,i,e),s.parentElement.insertBefore(this.previewElement,s),this.savePreviewElPosition(this.previewElement),document.body.appendChild(this.draggedElement),this.enteredTarget=this.previewElement,this.emit("dragStart",s)))}}onDragMove(t,i,e,r){let s=this.draggedElement,n=this.previewElement;if(i&&s&&n){t.preventDefault(),this.updateDraggedElPosition(s,e,r);let l=v(i,o=>o.hasAttribute(this.listItemAttribute)||o.hasAttribute(this.listAttribute)||o.hasAttribute(this.previewElementAttribute));if(l&&l!==n&&!this.elementsAnimator.isMoved(l,n)){let o=n!==l&&this.enteredTarget!==l;this.enteredTarget=l;let a=l.hasAttribute(this.listAttribute)?l:this.searchList(String(l.getAttribute(this.listIdAttribute))),h=n.getAttribute(this.previewElementListSharedAttribute)===a.getAttribute(this.listSharedAttribute);if(!a.hasAttribute(this.listDropDisabledAttribute)&&h)if(o)l.hasAttribute(this.listAttribute)?this.placeElementToList(n,r,l):this.replaceElement(r,l,n),this.emit("dragEnter",l);else{let{directionY:u,y:d}=this.draggedElementPosition;!l.hasAttribute(this.listAttribute)&&(u===1&&r<d||u===-1&&r>d)&&this.replaceElement(r,l,n),this.emit("dragOver",l)}}this.draggedElementPosition.x!==e&&Object.assign(this.draggedElementPosition,{x:e,directionX:e>this.draggedElementPosition.x?1:-1}),this.draggedElementPosition.y!==r&&Object.assign(this.draggedElementPosition,{y:r,directionY:r>this.draggedElementPosition.y?1:-1}),this.draggedElementPosition.x=e,this.draggedElementPosition.y=r,this.emit("dragMove",i),this.autoScroller.shouldEnableAutoScroller(e,r)}}onDragEnd=()=>{this.autoScroller.stopScroller();let t=this.draggedElement,i=this.previewElement,e=this.previewElementList;if(t&&i){let r=window.getComputedStyle(i);if(this.animationDuration!==0){let o=String(i.getAttribute(this.previewElementDestinationPositionAttribute)),a=o?JSON.parse(o):g(i),h=parseFloat(r.marginLeft),c=parseFloat(r.marginTop);this.elementsAnimator.animate(t,a.x-h,a.y-c,()=>{i.replaceWith(t),t.setAttribute(this.listIdAttribute,String(i.getAttribute(this.listIdAttribute))),this.draggedElementClass&&L(t,this.draggedElementClass),t.style.cssText=this.originalStyle})}else i.replaceWith(t),t.setAttribute(this.listIdAttribute,String(i.getAttribute(this.listIdAttribute))),this.draggedElementClass&&L(t,this.draggedElementClass),t.style.cssText=this.originalStyle;let n=Array.from(this.searchListItems(e)).indexOf(t),l=[];if(e.getAttribute(this.listAttribute)!==i.getAttribute(this.previewElementOriginalListAttribute)){let o=Array.from(this.searchListItems(this.previewElementOriginalList)),a=Array.from(this.searchListItems(e));l=[...o,...a]}else n!==this.draggedElementOriginalIndex&&(l=[...Array.from(this.searchListItems(e))]);this.resetDraggingState(),l.length>0&&this.emit("itemsUpdated",l),this.emit("dragEnd")}};placeElementToList=(t,i,e)=>{let r=Array.from(this.searchListItems(e)),s=this.previewElementList,n=Array.from(this.searchListItems(s)),l=n.indexOf(t),o=b(n,l,n.length-1),a=g(r[r.length-1]);if(r.length===0){this.elementsAnimator.animateElementsMovement(o,()=>{e.insertBefore(t,null),this.savePreviewElPosition(t)}),t.setAttribute(this.listIdAttribute,String(e.getAttribute(this.listAttribute))),this.previewElementList=e;return}else if(i>a.y+a.h){this.elementsAnimator.animateElementsMovement(o,()=>{e.appendChild(t),this.savePreviewElPosition(t)}),t.setAttribute(this.listIdAttribute,String(e.getAttribute(this.listAttribute))),this.previewElementList=e;return}};replaceElement=(t,i,e)=>{let r=i.parentNode,s=this.searchList(String(i.getAttribute(this.listIdAttribute))),n=Array.from(this.searchListItems(s)),l=n.indexOf(i),o=this.previewElementList,a=Array.from(this.searchListItems(o)),h=a.indexOf(e);if(o.getAttribute(this.listAttribute)!==s.getAttribute(this.listAttribute)){let A=b(a,h,a.length-1),S=b(n,l,n.length-1),M=A.concat(S);this.elementsAnimator.animateElementsMovement(M,()=>{r.insertBefore(e,i),this.savePreviewElPosition(e)}),this.previewElementList=s;return}let c=i.getBoundingClientRect(),u=c.y+c.height/2,d=b(n,h,l);t>u?l>Number(h)?this.elementsAnimator.animateElementsMovement(d,()=>{r.insertBefore(e,n[l].nextElementSibling),this.savePreviewElPosition(e)}):this.elementsAnimator.animateElementsMovement(d,()=>{r.insertBefore(e,n[l]),this.savePreviewElPosition(e)}):t<u&&(l<Number(h)?this.elementsAnimator.animateElementsMovement(d,()=>{r.insertBefore(e,n[l]),this.savePreviewElPosition(e)}):l>=0&&l<n.length&&this.elementsAnimator.animateElementsMovement(d,()=>{r.insertBefore(e,n[l].nextElementSibling),this.savePreviewElPosition(e)})),e.setAttribute(this.listIdAttribute,String(s.getAttribute(this.listAttribute))),this.previewElementList=s};createDraggedElement=(t,i,e,r)=>{window.getSelection()?.removeAllRanges();let s=i,n=window.getComputedStyle(s),l=parseFloat(n.marginLeft),o=parseFloat(n.marginTop),a=n.getPropertyValue("list-style-type"),h=s.getBoundingClientRect();Object.assign(this.draggedElementPosition,{x:e,y:r,offsetX:e-h.x+l,offsetY:r-h.y+o});let c=Array.from(this.searchListItems(t));this.draggedElementOriginalIndex=c.indexOf(i),s.setAttribute(this.draggedElementAttribute,""),s.setAttribute(this.ignoreElementAttribute,""),this.originalStyle=s.style.cssText;let u=s.getBoundingClientRect();if(s.style.width=`${u.width}px`,s.style.height=`${u.height}px`,s.style.zIndex=String(999999),a&&(s.style.listStyleType=a),this.draggedElementStyle)for(let[d,A]of Object.entries(this.draggedElementStyle))s.style.hasOwnProperty(d)&&s.style.setProperty(d,A);return this.draggedElementClass&&f(s,this.draggedElementClass),s.style.position="fixed",s.style.touchAction="none",s.style.pointerEvents="none",s.style.left=String(0),s.style.top=String(0),s.style.transform=`translate(${e-this.draggedElementPosition.offsetX}px, ${r-this.draggedElementPosition.offsetY}px)`,s};createPreviewElement=(t,i)=>{let e=document.createElement("div");e.className=i.className;let r=String(i.getAttribute(this.listIdAttribute)),s=String(t.getAttribute(this.listSharedAttribute));e.setAttribute(this.previewElementOriginalListAttribute,r),e.setAttribute(this.listIdAttribute,r),e.setAttribute(this.previewElementListSharedAttribute,s),e.setAttribute(this.previewElementAttribute,""),this.previewElementList=t,this.previewElementOriginalList=t;let n=getComputedStyle(i),l=["width","height","min-width","min-height","max-width","max-height","padding-top","padding-right","padding-bottom","padding-left","margin-top","margin-right","margin-bottom","margin-left","box-sizing"];for(let o of l)e.style.setProperty(o,n.getPropertyValue(o));if(this.previewElementClass&&f(e,this.previewElementClass),this.previewElementStyle)for(let[o,a]of Object.entries(this.previewElementStyle))e.style.hasOwnProperty(o)&&e.style.setProperty(o,a);return e};resetDraggingState=()=>{this.draggedElement?.removeAttribute(this.draggedElementAttribute),this.draggedElement?.removeAttribute(this.ignoreElementAttribute),this.draggedElement=null,this.draggedElementOriginalIndex=null,this.enteredTarget=null,this.originalStyle="",this.previewElement=null,this.previewElementList=null,this.previewElementOriginalList=null,this.draggedElementPosition={x:0,y:0,offsetX:0,offsetY:0,directionY:0,directionX:0}};updateDraggedElPosition=(t,i,e)=>{t.style.transform=`translate(${i-this.draggedElementPosition.offsetX}px, ${e-this.draggedElementPosition.offsetY}px)`};searchList=t=>document.querySelector(`[${this.listAttribute}="${t}"]`);searchListItems=t=>t.querySelectorAll(`[${this.listItemAttribute}],[${this.previewElementAttribute}]`);savePreviewElPosition=t=>{t.setAttribute(this.previewElementDestinationPositionAttribute,JSON.stringify(g(t)))}};export{T as SimpleDragAndDrop};
