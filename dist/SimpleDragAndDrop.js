var E=class{scrollToPositionThreshold;scrollSpeed;startTime;scrollAnimationState;actualScrollAction;constructor(e=100,i=50){this.scrollToPositionThreshold=i,this.scrollSpeed=e,this.startTime=null,this.scrollAnimationState=null,this.actualScrollAction=null}shouldEnableAutoScroller(e,i){let t=Math.max(document.documentElement.clientWidth||0,window.innerWidth||0),r=Math.max(document.documentElement.clientHeight||0,window.innerHeight||0),s=document.elementFromPoint(e,i);if(s){let n=s.getBoundingClientRect();e>t-this.scrollToPositionThreshold?this.getLastScrollableElementOnAxis("x","f",s,1):e-n.x>s.clientWidth-this.scrollToPositionThreshold?this.scrollElement("x","f",this.getFirstFullyVisibleElementOnAxis("x",s),2):e<this.scrollToPositionThreshold?this.getLastScrollableElementOnAxis("x","b",s,3):e-n.x<this.scrollToPositionThreshold?this.scrollElement("x","b",this.getFirstFullyVisibleElementOnAxis("x",s),4):i<this.scrollToPositionThreshold?this.getLastScrollableElementOnAxis("y","b",s,5):i-n.y<this.scrollToPositionThreshold?this.scrollElement("y","b",this.getFirstFullyVisibleElementOnAxis("y",s),6):i>r-this.scrollToPositionThreshold?this.getLastScrollableElementOnAxis("y","f",s,7):i-n.y>n.height-this.scrollToPositionThreshold?this.scrollElement("y","b",this.getFirstFullyVisibleElementOnAxis("y",s),8):this.stopScroller()}}getLastScrollableElementOnAxis(e,i,t,r){if(r!==this.actualScrollAction){this.stopScroller(),this.actualScrollAction=r;let s;for(;t;)this.isScrollable(e,t)&&!this.isScrolledToEnd(e,i,t)&&(s=t),t=t.parentElement;s&&this.startScroller(e,i,s)}}scrollElement(e,i,t,r){r!==this.actualScrollAction&&(this.stopScroller(),this.actualScrollAction=r,this.startScroller(e,i,t))}isScrollable=(e,i)=>{let t=getComputedStyle(i),r=t.overflowX,s=t.overflowY;return e==="x"?r==="hidden"?!1:i.scrollWidth>i.clientWidth:s==="hidden"?!1:i.scrollHeight>i.clientHeight};isScrolledToEnd=(e,i,t,r=2)=>e==="x"?i==="f"?Math.abs(t.scrollWidth-t.scrollLeft-t.clientWidth)<=r:t.scrollLeft<=r:i==="f"?Math.abs(t.scrollHeight-t.scrollTop-t.clientHeight)<=r:t.scrollTop<=r;startScroller(e,i,t,r=0){this.scrollAnimationState===null&&(this.scrollAnimationState=requestAnimationFrame(s=>{this.startTime||(this.startTime=s);let n=s-this.startTime;this.startTime=s,r+=n/1e3*this.scrollSpeed,r>1&&(r=i==="f"?r:-r,e==="y"?t?.scrollBy({left:0,top:r,behavior:"instant"}):e==="x"&&t?.scrollBy({left:r,top:0,behavior:"instant"}),r=0),this.scrollAnimationState=null,this.startScroller(e,i,t,r)}))}isFullyVisibleOnAxis(e,i,t){return e==="x"?i.clientWidth<t.clientWidth:i.clientHeight<t.clientHeight}getFirstFullyVisibleElementOnAxis(e,i){let t=i.parentElement;for(;t;){if(this.isFullyVisibleOnAxis(e,i,t))return i;i=t,t=t.parentElement}return i}stopScroller(){this.scrollAnimationState&&cancelAnimationFrame(this.scrollAnimationState),this.startTime=null,this.scrollAnimationState=null,this.actualScrollAction=null}};var p=(m,e,i)=>{let t=m;for(;t&&t instanceof HTMLElement;){if(e(t))return t;if(i&&t===i)break;t=t.parentElement}return null};var b=(m,e,i)=>(e>i&&([e,i]=[i,e]),m.slice(e,i+1));var c=m=>{let e=m.getBoundingClientRect();return{x:e.left,y:e.top,w:e.width,h:e.height}},f=(m,e)=>{let i=e.split(/\s+/).filter(Boolean);m.classList.add(...i)},L=(m,e)=>{let i=e.split(/\s+/).filter(Boolean);m.classList.remove(...i)};var A=class{animationDuration;oldPositionAttribute;animationAttribute;isMovedAttribute;ignoreAttribute;constructor(e=500,i="data-el-ignore",t="data-el-animation-att",r="data-el-moved-att",s="data-el-old-pos"){this.animationDuration=e,this.oldPositionAttribute=s,this.animationAttribute=t,this.isMovedAttribute=r,this.ignoreAttribute=i}isMoved(...e){let i=!1;return e.forEach(t=>{t.hasAttribute(this.isMovedAttribute)&&(i=!0)}),i}removeAnimation=e=>{e.style.transition="",e.style.transform=""};saveElementPosition=(e,i)=>(e.setAttribute(this.oldPositionAttribute,JSON.stringify(i)),e);moveToSavedPosition=e=>{let i=c(e),t=JSON.parse(e.getAttribute(this.oldPositionAttribute));e.style.transform=`translate3d(${t.x-i.x}px, ${t.y-i.y}px, 0px)`};animate=(e,i=0,t=0,r)=>{if(e.setAttribute(this.isMovedAttribute,""),e.style.transition=`transform ${this.animationDuration}ms ease`,e.style.transform=`translate3d(${i}px, ${t}px, 0px)`,e.hasAttribute(this.animationAttribute)){let n=Number(e.getAttribute(this.animationAttribute));clearTimeout(n)}let s=setTimeout(()=>{this.removeAnimation(e),e.removeAttribute(this.oldPositionAttribute),e.removeAttribute(this.isMovedAttribute),e.removeAttribute(this.animationAttribute),r?.()},this.animationDuration);e.setAttribute(this.animationAttribute,String(s))};animateElementsMovement=(e,i)=>{e.forEach(t=>{this.saveElementPosition(t,c(t)),t.hasAttribute(this.ignoreAttribute)||(this.saveElementPosition(t,c(t)),this.removeAnimation(t))}),i(),e.forEach(t=>{t.setAttribute(this.isMovedAttribute,""),this.moveToSavedPosition(t),t.offsetHeight,this.animate(t)})}};var T=()=>{let m={};return{on:(t,r)=>{m[t]||(m[t]=[]),m[t].push(r)},emit:(t,r)=>{let s=m[t];s&&s.forEach(n=>n(r))}}};var y=class{options;animationDuration;draggedElementStyle;draggedElementClass;previewElementStyle;previewElementClass;draggedElement;draggedElementOriginalIndex;draggedElementPosition;originalStyle;previewElement;previewElementList;previewElementOriginalList;enteredTarget;draggedElementAttribute;previewElementAttribute;previewElementOriginalListAttribute;previewElementListSharedAttribute;previewElementDestinationPositionAttribute;listSharedAttribute;listAttribute;listHasActionBtnAttribute;listItemActionBtnAttribute;listDragDisabledAttribute;listDropDisabledAttribute;listItemAttribute;listIdAttribute;autoScroller;ignoreElementAttribute;elementsAnimator;elementsWithListeners;on;emit;constructor(e){this.animationDuration=e.animationDuration??150,this.previewElementStyle=e.previewElementStyle??null,this.previewElementClass=e.previewElementClass??"",this.draggedElementStyle=e.draggedElementStyle??null,this.draggedElementClass=e.draggedElementClass??"",this.previewElement=null,this.previewElementList=null,this.previewElementOriginalList=null,this.draggedElement=null,this.draggedElementOriginalIndex=null,this.draggedElementPosition={x:0,y:0,offsetX:0,offsetY:0,directionY:0,directionX:0},this.originalStyle="",this.enteredTarget=null,this.draggedElementAttribute="data-dragging",this.previewElementAttribute="data-preview",this.previewElementOriginalListAttribute="data-prev-orig-list",this.previewElementListSharedAttribute="data-prev-list-shared",this.previewElementDestinationPositionAttribute="data-prev-destination-position",this.listSharedAttribute="data-list-shared",this.listAttribute="data-list",this.listHasActionBtnAttribute="data-list-has-action-btn",this.listDragDisabledAttribute="data-list-drag-disabled",this.listDropDisabledAttribute="data-list-drop-disabled",this.listItemAttribute="data-list-item",this.listIdAttribute="data-list-id",this.listItemActionBtnAttribute="data-list-item-action-btn",this.autoScroller=new E(500,50),this.ignoreElementAttribute="data-el-ignore",this.elementsAnimator=new A(this.animationDuration,this.ignoreElementAttribute),Object.assign(this,T()),this.elementsWithListeners=[],this.init()}init=()=>{let e=n=>this.onDragStart(n,n.clientX,n.clientY);document.addEventListener("mousedown",e);let i=n=>this.onDragStart(n,n.touches[0].clientX,n.touches[0].clientY);document.addEventListener("touchstart",i,{passive:!1});let t=()=>this.onDragEnd();document.addEventListener("mouseup",t),document.addEventListener("touchend",t);let r=n=>this.onDragMove(n,n.target,n.clientX,n.clientY);document.addEventListener("mousemove",r,{passive:!1});let s=n=>this.onDragMove(n,document.elementFromPoint(n.touches[0].clientX,n.touches[0].clientY),n.touches[0].clientX,n.touches[0].clientY);document.addEventListener("touchmove",s,{passive:!1}),this.elementsWithListeners.push({el:document,events:{mousedown:e,touchstart:i,mouseup:t,touchend:t,mousemove:r,onTouchmove:s}})};clearEventListeners=()=>{this.elementsWithListeners.forEach(e=>{for(let[i,t]of Object.entries(e.events))e.el.removeEventListener(i,t)})};onDragStart(e,i,t){let r=e.target;if(!(e instanceof MouseEvent&&e.button!==0)&&!this.draggedElement&&r instanceof HTMLElement){let s=p(r,l=>l.hasAttribute(this.listItemAttribute)&&l.hasAttribute(this.listIdAttribute)),n=this.searchList(String(s?.getAttribute(this.listIdAttribute)));if(s&&n){e.preventDefault();let l=n.hasAttribute(this.listHasActionBtnAttribute)?p(r,o=>o.hasAttribute(this.listItemActionBtnAttribute),s):null;!this.elementsAnimator.isMoved(s)&&!n.hasAttribute(this.listDragDisabledAttribute)&&s.parentElement&&(!n.hasAttribute(this.listHasActionBtnAttribute)||l)&&(this.previewElement=this.createPreviewElement(n,s),this.draggedElement=this.createDraggedElement(n,s,i,t),s.parentElement.insertBefore(this.previewElement,s),this.savePreviewElPosition(this.previewElement),document.body.appendChild(this.draggedElement),this.enteredTarget=this.previewElement,this.emit("dragStart",s))}}}onDragMove(e,i,t,r){let s=this.draggedElement,n=this.previewElement;if(i&&s&&n){e.preventDefault(),this.updateDraggedElPosition(s,t,r);let l=p(i,o=>o.hasAttribute(this.listItemAttribute)||o.hasAttribute(this.listAttribute)||o.hasAttribute(this.previewElementAttribute));if(l&&l!==n&&!this.elementsAnimator.isMoved(l,n)){let o=n!==l&&this.enteredTarget!==l;this.enteredTarget=l;let a=l.hasAttribute(this.listAttribute)?l:this.searchList(String(l.getAttribute(this.listIdAttribute))),h=n.getAttribute(this.previewElementListSharedAttribute)===a.getAttribute(this.listSharedAttribute);if(!a.hasAttribute(this.listDropDisabledAttribute)&&h)if(o)l.hasAttribute(this.listAttribute)?this.placeElementToList(n,r,l):this.replaceElement(r,l,n),this.enteredTarget=n,this.emit("dragEnter",l);else{let{directionY:u,y:d}=this.draggedElementPosition;!l.hasAttribute(this.listAttribute)&&(u===1&&r<d||u===-1&&r>d)&&this.replaceElement(r,l,n)}}this.draggedElementPosition.x!==t&&Object.assign(this.draggedElementPosition,{x:t,directionX:t>this.draggedElementPosition.x?1:-1}),this.draggedElementPosition.y!==r&&Object.assign(this.draggedElementPosition,{y:r,directionY:r>this.draggedElementPosition.y?1:-1}),this.draggedElementPosition.x=t,this.draggedElementPosition.y=r,this.emit("dragOver",l),this.autoScroller.shouldEnableAutoScroller(t,r)}}onDragEnd=()=>{this.autoScroller.stopScroller();let e=this.draggedElement,i=this.previewElement,t=this.previewElementList,r=this.previewElementOriginalList,s=this.draggedElementOriginalIndex,n=this.originalStyle;if(e&&i){let l=window.getComputedStyle(i);if(this.animationDuration!==0){let o=String(i.getAttribute(this.previewElementDestinationPositionAttribute)),a=o?JSON.parse(o):c(i),h=parseFloat(l.marginLeft),g=parseFloat(l.marginTop);this.elementsAnimator.animate(e,a.x-h,a.y-g,()=>{this.replacePreviewElementWithDraggedElement(i,e,n),this.checksElementsUpdates(t,r,i,e,s)})}else this.replacePreviewElementWithDraggedElement(i,e,n),this.checksElementsUpdates(t,r,i,e,s);this.resetDraggingState(),this.emit("dragEnd")}};replacePreviewElementWithDraggedElement=(e,i,t)=>{e.replaceWith(i),i.setAttribute(this.listIdAttribute,String(e.getAttribute(this.listIdAttribute))),this.draggedElementClass&&L(i,this.draggedElementClass),i.style.cssText=t};checksElementsUpdates=(e,i,t,r,s)=>{let n=Array.from(this.searchListItems(e)),l=n.indexOf(r);if(e.getAttribute(this.listAttribute)!==t.getAttribute(this.previewElementOriginalListAttribute)){let o=[],a=Array.from(this.searchListItems(i));o.push(a),o.push(n),this.emit("itemsUpdated",o)}else l!==s&&this.emit("itemsUpdated",n)};placeElementToList=(e,i,t)=>{let r=Array.from(this.searchListItems(t)),s=this.previewElementList,n=Array.from(this.searchListItems(s)),l=n.indexOf(e),o=b(n,l,n.length-1);if(r.length===0){this.elementsAnimator.animateElementsMovement(o,()=>{t.insertBefore(e,null),this.savePreviewElPosition(e)}),e.setAttribute(this.listIdAttribute,String(t.getAttribute(this.listAttribute))),this.previewElementList=t;return}let a=c(r[r.length-1]);if(i>a.y+a.h){this.elementsAnimator.animateElementsMovement(o,()=>{t.appendChild(e),this.savePreviewElPosition(e)}),e.setAttribute(this.listIdAttribute,String(t.getAttribute(this.listAttribute))),this.previewElementList=t;return}};replaceElement=(e,i,t)=>{let r=i.parentNode,s=this.searchList(String(i.getAttribute(this.listIdAttribute))),n=Array.from(this.searchListItems(s)),l=n.indexOf(i),o=this.previewElementList,a=Array.from(this.searchListItems(o)),h=a.indexOf(t);if(o.getAttribute(this.listAttribute)!==s.getAttribute(this.listAttribute)){let v=b(a,h,a.length-1),S=b(n,l,n.length-1),M=v.concat(S);this.elementsAnimator.animateElementsMovement(M,()=>{r.insertBefore(t,i),this.savePreviewElPosition(t)}),this.previewElementList=s,t.setAttribute(this.listIdAttribute,String(s.getAttribute(this.listAttribute)));return}let g=i.getBoundingClientRect(),u=g.y+g.height/2,d=b(n,h,l);e>u?l>Number(h)?this.elementsAnimator.animateElementsMovement(d,()=>{r.insertBefore(t,n[l].nextElementSibling),this.savePreviewElPosition(t)}):this.elementsAnimator.animateElementsMovement(d,()=>{r.insertBefore(t,n[l]),this.savePreviewElPosition(t)}):e<u&&(l<Number(h)?this.elementsAnimator.animateElementsMovement(d,()=>{r.insertBefore(t,n[l]),this.savePreviewElPosition(t)}):l>=0&&l<n.length&&this.elementsAnimator.animateElementsMovement(d,()=>{r.insertBefore(t,n[l].nextElementSibling),this.savePreviewElPosition(t)})),t.setAttribute(this.listIdAttribute,String(s.getAttribute(this.listAttribute))),this.previewElementList=s};createDraggedElement=(e,i,t,r)=>{window.getSelection()?.removeAllRanges();let s=i,n=window.getComputedStyle(s),l=parseFloat(n.marginLeft),o=parseFloat(n.marginTop),a=n.getPropertyValue("list-style-type"),h=s.getBoundingClientRect();Object.assign(this.draggedElementPosition,{x:t,y:r,offsetX:t-h.x+l,offsetY:r-h.y+o});let g=Array.from(this.searchListItems(e));this.draggedElementOriginalIndex=g.indexOf(i),s.setAttribute(this.draggedElementAttribute,""),s.setAttribute(this.ignoreElementAttribute,""),this.originalStyle=s.style.cssText;let u=s.getBoundingClientRect();if(s.style.setProperty("width",`${u.width}px`,"important"),s.style.setProperty("height",`${u.height}px`,"important"),s.style.setProperty("z-index","999999","important"),a&&(s.style.listStyleType=a),this.draggedElementStyle)for(let[d,v]of Object.entries(this.draggedElementStyle))s.style.hasOwnProperty(d)&&s.style.setProperty(d,v);return this.draggedElementClass&&f(s,this.draggedElementClass),s.style.position="fixed",s.style.touchAction="none",s.style.pointerEvents="none",s.style.left=String(0),s.style.top=String(0),s.style.transform=`translate(${t-this.draggedElementPosition.offsetX}px, ${r-this.draggedElementPosition.offsetY}px)`,s};createPreviewElement=(e,i)=>{let t=document.createElement("div");t.className=i.className;let r=String(i.getAttribute(this.listIdAttribute)),s=String(e.getAttribute(this.listSharedAttribute));t.setAttribute(this.previewElementOriginalListAttribute,r),t.setAttribute(this.listIdAttribute,r),t.setAttribute(this.previewElementListSharedAttribute,s),t.setAttribute(this.previewElementAttribute,""),this.previewElementList=e,this.previewElementOriginalList=e;let n=getComputedStyle(i),l=["width","height","min-width","min-height","max-width","max-height","padding-top","padding-right","padding-bottom","padding-left","margin-top","margin-right","margin-bottom","margin-left","box-sizing"];for(let o of l)t.style.setProperty(o,n.getPropertyValue(o));if(this.previewElementClass&&f(t,this.previewElementClass),this.previewElementStyle)for(let[o,a]of Object.entries(this.previewElementStyle))t.style.hasOwnProperty(o)&&t.style.setProperty(o,a);return t};resetDraggingState=()=>{this.draggedElement?.removeAttribute(this.draggedElementAttribute),this.draggedElement?.removeAttribute(this.ignoreElementAttribute),this.draggedElement=null,this.draggedElementOriginalIndex=null,this.enteredTarget=null,this.originalStyle="",this.previewElement=null,this.previewElementList=null,this.previewElementOriginalList=null,this.draggedElementPosition={x:0,y:0,offsetX:0,offsetY:0,directionY:0,directionX:0}};updateDraggedElPosition=(e,i,t)=>{e.style.transform=`translate(${i-this.draggedElementPosition.offsetX}px, ${t-this.draggedElementPosition.offsetY}px)`};searchList=e=>document.querySelector(`[${this.listAttribute}="${e}"]`);searchListItems=e=>e.querySelectorAll(`[${this.listItemAttribute}],[${this.previewElementAttribute}]`);savePreviewElPosition=e=>{e.setAttribute(this.previewElementDestinationPositionAttribute,JSON.stringify(c(e)))}};export{y as SimpleDragAndDrop};
