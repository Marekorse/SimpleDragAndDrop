var E=class{scrollToPositionThreshold;scrollSpeed;startTime;scrollAnimationState;actualScrollAction;constructor(t=100,i=50){this.scrollToPositionThreshold=i,this.scrollSpeed=t,this.startTime=null,this.scrollAnimationState=null,this.actualScrollAction=null}shouldEnableAutoScroller(t,i){let e=Math.max(document.documentElement.clientWidth||0,window.innerWidth||0),n=Math.max(document.documentElement.clientHeight||0,window.innerHeight||0),s=document.elementFromPoint(t,i);if(s){let r=s.getBoundingClientRect();t>e-this.scrollToPositionThreshold?this.getLastScrollableElementOnAxis("x","f",s,1):t-r.x>s.clientWidth-this.scrollToPositionThreshold?this.scrollElement("x","f",this.getFirstFullyVisibleElementOnAxis("x",s),2):t<this.scrollToPositionThreshold?this.getLastScrollableElementOnAxis("x","b",s,3):t-r.x<this.scrollToPositionThreshold?this.scrollElement("x","b",this.getFirstFullyVisibleElementOnAxis("x",s),4):i<this.scrollToPositionThreshold?this.getLastScrollableElementOnAxis("y","b",s,5):i-r.y<this.scrollToPositionThreshold?this.scrollElement("y","b",this.getFirstFullyVisibleElementOnAxis("y",s),6):i>n-this.scrollToPositionThreshold?this.getLastScrollableElementOnAxis("y","f",s,7):i-r.y>r.height-this.scrollToPositionThreshold?this.scrollElement("y","b",this.getFirstFullyVisibleElementOnAxis("y",s),8):this.stopScroller()}}getLastScrollableElementOnAxis(t,i,e,n){if(n!==this.actualScrollAction){this.stopScroller(),this.actualScrollAction=n;let s;for(;e;)this.isScrollable(t,e)&&!this.isScrolledToEnd(t,i,e)&&(s=e),e=e.parentElement;s&&this.startScroller(t,i,s)}}scrollElement(t,i,e,n){n!==this.actualScrollAction&&(this.stopScroller(),this.actualScrollAction=n,this.startScroller(t,i,e))}isScrollable=(t,i)=>{let e=getComputedStyle(i),n=e.overflowX,s=e.overflowY;return t==="x"?n==="hidden"?!1:i.scrollWidth>i.clientWidth:s==="hidden"?!1:i.scrollHeight>i.clientHeight};isScrolledToEnd=(t,i,e,n=2)=>t==="x"?i==="f"?Math.abs(e.scrollWidth-e.scrollLeft-e.clientWidth)<=n:e.scrollLeft<=n:i==="f"?Math.abs(e.scrollHeight-e.scrollTop-e.clientHeight)<=n:e.scrollTop<=n;startScroller(t,i,e,n=0){this.scrollAnimationState===null&&(this.scrollAnimationState=requestAnimationFrame(s=>{this.startTime||(this.startTime=s);let r=s-this.startTime;this.startTime=s,n+=r/1e3*this.scrollSpeed,n>1&&(n=i==="f"?n:-n,t==="y"?e?.scrollBy({left:0,top:n,behavior:"instant"}):t==="x"&&e?.scrollBy({left:n,top:0,behavior:"instant"}),n=0),this.scrollAnimationState=null,this.startScroller(t,i,e,n)}))}isFullyVisibleOnAxis(t,i,e){return t==="x"?i.clientWidth<e.clientWidth:i.clientHeight<e.clientHeight}getFirstFullyVisibleElementOnAxis(t,i){let e=i.parentElement;for(;e;){if(this.isFullyVisibleOnAxis(t,i,e))return i;i=e,e=e.parentElement}return i}stopScroller(){this.scrollAnimationState&&cancelAnimationFrame(this.scrollAnimationState),this.startTime=null,this.scrollAnimationState=null,this.actualScrollAction=null}};var v=(m,t)=>{let i=m;for(;i;){if(i instanceof HTMLElement&&t(i))return i;i=i.parentElement}return null};var b=(m,t,i)=>(t>i&&([t,i]=[i,t]),m.slice(t,i+1));var c=m=>{let t=m.getBoundingClientRect();return{x:t.left,y:t.top,w:t.width,h:t.height}},f=(m,t)=>{let i=t.split(/\s+/).filter(Boolean);m.classList.add(...i)},L=(m,t)=>{let i=t.split(/\s+/).filter(Boolean);m.classList.remove(...i)};var p=class{animationDuration;oldPositionAttribute;animationAttribute;isMovedAttribute;ignoreAttribute;constructor(t=500,i="data-el-ignore",e="data-el-animation-att",n="data-el-moved-att",s="data-el-old-pos"){this.animationDuration=t,this.oldPositionAttribute=s,this.animationAttribute=e,this.isMovedAttribute=n,this.ignoreAttribute=i}isMoved(...t){let i=!1;return t.forEach(e=>{e.hasAttribute(this.isMovedAttribute)&&(i=!0)}),i}removeAnimation=t=>{t.style.transition="",t.style.transform=""};saveElementPosition=(t,i)=>(t.setAttribute(this.oldPositionAttribute,JSON.stringify(i)),t);moveToSavedPosition=t=>{let i=c(t),e=JSON.parse(t.getAttribute(this.oldPositionAttribute));t.style.transform=`translate3d(${e.x-i.x}px, ${e.y-i.y}px, 0px)`};animate=(t,i=0,e=0,n)=>{if(t.setAttribute(this.isMovedAttribute,""),t.style.transition=`transform ${this.animationDuration}ms ease`,t.style.transform=`translate3d(${i}px, ${e}px, 0px)`,t.hasAttribute(this.animationAttribute)){let r=Number(t.getAttribute(this.animationAttribute));clearTimeout(r)}let s=setTimeout(()=>{this.removeAnimation(t),t.removeAttribute(this.oldPositionAttribute),t.removeAttribute(this.isMovedAttribute),t.removeAttribute(this.animationAttribute),n?.()},this.animationDuration);t.setAttribute(this.animationAttribute,String(s))};animateElementsMovement=(t,i)=>{t.forEach(e=>{this.saveElementPosition(e,c(e)),e.hasAttribute(this.ignoreAttribute)||(this.saveElementPosition(e,c(e)),this.removeAnimation(e))}),i(),t.forEach(e=>{e.setAttribute(this.isMovedAttribute,""),this.moveToSavedPosition(e),e.offsetHeight,this.animate(e)})}};var T=()=>{let m={};return{on:(e,n)=>{m[e]||(m[e]=[]),m[e].push(n)},emit:(e,n)=>{let s=m[e];s&&s.forEach(r=>r(n))}}};var y=class{options;animationDuration;draggedElementStyle;draggedElementClass;previewElementStyle;previewElementClass;draggedElement;draggedElementOriginalIndex;draggedElementPosition;originalStyle;previewElement;previewElementList;previewElementOriginalList;enteredTarget;draggedElementAttribute;previewElementAttribute;previewElementOriginalListAttribute;previewElementListSharedAttribute;previewElementDestinationPositionAttribute;listSharedAttribute;listAttribute;listHasActionBtnAttribute;listItemActionBtnAttribute;listDragDisabledAttribute;listDropDisabledAttribute;listItemAttribute;listIdAttribute;autoScroller;ignoreElementAttribute;elementsAnimator;elementsWithListeners;on;emit;constructor(t){this.animationDuration=t.animationDuration??150,this.previewElementStyle=t.previewElementStyle??null,this.previewElementClass=t.previewElementClass??"",this.draggedElementStyle=t.draggedElementStyle??null,this.draggedElementClass=t.draggedElementClass??"",this.previewElement=null,this.previewElementList=null,this.previewElementOriginalList=null,this.draggedElement=null,this.draggedElementOriginalIndex=null,this.draggedElementPosition={x:0,y:0,offsetX:0,offsetY:0,directionY:0,directionX:0},this.originalStyle="",this.enteredTarget=null,this.draggedElementAttribute="data-dragging",this.previewElementAttribute="data-preview",this.previewElementOriginalListAttribute="data-prev-orig-list",this.previewElementListSharedAttribute="data-prev-list-shared",this.previewElementDestinationPositionAttribute="data-prev-destination-position",this.listSharedAttribute="data-list-shared",this.listAttribute="data-list",this.listHasActionBtnAttribute="data-list-has-action-btn",this.listDragDisabledAttribute="data-list-drag-disabled",this.listDropDisabledAttribute="data-list-drop-disabled",this.listItemAttribute="data-list-item",this.listIdAttribute="data-list-id",this.listItemActionBtnAttribute="data-list-item-action-btn",this.autoScroller=new E(500,50),this.ignoreElementAttribute="data-el-ignore",this.elementsAnimator=new p(this.animationDuration,this.ignoreElementAttribute),Object.assign(this,T()),this.elementsWithListeners=[],this.init()}init=()=>{let t=r=>this.onDragStart(r,r.clientX,r.clientY);document.addEventListener("mousedown",t);let i=r=>this.onDragStart(r,r.touches[0].clientX,r.touches[0].clientY);document.addEventListener("touchstart",i,{passive:!1});let e=()=>this.onDragEnd();document.addEventListener("mouseup",e),document.addEventListener("touchend",e);let n=r=>this.onDragMove(r,r.target,r.clientX,r.clientY);document.addEventListener("mousemove",n,{passive:!1});let s=r=>this.onDragMove(r,document.elementFromPoint(r.touches[0].clientX,r.touches[0].clientY),r.touches[0].clientX,r.touches[0].clientY);document.addEventListener("touchmove",s,{passive:!1}),this.elementsWithListeners.push({el:document,events:{mousedown:t,touchstart:i,mouseup:e,touchend:e,mousemove:n,onTouchmove:s}})};clearEventListeners=()=>{this.elementsWithListeners.forEach(t=>{for(let[i,e]of Object.entries(t.events))t.el.removeEventListener(i,e)})};onDragStart(t,i,e){let n=t.target;if(!(t instanceof MouseEvent&&t.button!==0)&&!this.draggedElement&&n instanceof HTMLElement){let s=v(n,l=>l.hasAttribute(this.listItemAttribute)&&l.hasAttribute(this.listIdAttribute)),r=this.searchList(String(s?.getAttribute(this.listIdAttribute)));s&&r&&(!r.hasAttribute(this.listHasActionBtnAttribute)||n.hasAttribute(this.listItemActionBtnAttribute))&&(t.preventDefault(),!this.elementsAnimator.isMoved(s)&&!r.hasAttribute(this.listDragDisabledAttribute)&&s.parentElement&&(this.previewElement=this.createPreviewElement(r,s),this.draggedElement=this.createDraggedElement(r,s,i,e),s.parentElement.insertBefore(this.previewElement,s),this.savePreviewElPosition(this.previewElement),document.body.appendChild(this.draggedElement),this.enteredTarget=this.previewElement,this.emit("dragStart",s)))}}onDragMove(t,i,e,n){let s=this.draggedElement,r=this.previewElement;if(i&&s&&r){t.preventDefault(),this.updateDraggedElPosition(s,e,n);let l=v(i,o=>o.hasAttribute(this.listItemAttribute)||o.hasAttribute(this.listAttribute)||o.hasAttribute(this.previewElementAttribute));if(l&&l!==r&&!this.elementsAnimator.isMoved(l,r)){let o=r!==l&&this.enteredTarget!==l;this.enteredTarget=l;let a=l.hasAttribute(this.listAttribute)?l:this.searchList(String(l.getAttribute(this.listIdAttribute))),h=r.getAttribute(this.previewElementListSharedAttribute)===a.getAttribute(this.listSharedAttribute);if(!a.hasAttribute(this.listDropDisabledAttribute)&&h)if(o)l.hasAttribute(this.listAttribute)?this.placeElementToList(r,n,l):this.replaceElement(n,l,r),this.enteredTarget=r,this.emit("dragEnter",l);else{let{directionY:u,y:d}=this.draggedElementPosition;!l.hasAttribute(this.listAttribute)&&(u===1&&n<d||u===-1&&n>d)&&this.replaceElement(n,l,r)}}this.draggedElementPosition.x!==e&&Object.assign(this.draggedElementPosition,{x:e,directionX:e>this.draggedElementPosition.x?1:-1}),this.draggedElementPosition.y!==n&&Object.assign(this.draggedElementPosition,{y:n,directionY:n>this.draggedElementPosition.y?1:-1}),this.draggedElementPosition.x=e,this.draggedElementPosition.y=n,this.emit("dragOver",l),this.autoScroller.shouldEnableAutoScroller(e,n)}}onDragEnd=()=>{this.autoScroller.stopScroller();let t=this.draggedElement,i=this.previewElement,e=this.previewElementList,n=this.previewElementOriginalList,s=this.draggedElementOriginalIndex,r=this.originalStyle;if(t&&i){let l=window.getComputedStyle(i);if(this.animationDuration!==0){let o=String(i.getAttribute(this.previewElementDestinationPositionAttribute)),a=o?JSON.parse(o):c(i),h=parseFloat(l.marginLeft),g=parseFloat(l.marginTop);this.elementsAnimator.animate(t,a.x-h,a.y-g,()=>{this.replacePreviewElementWithDraggedElement(i,t,r),this.checksElementsUpdates(e,n,i,t,s)})}else this.replacePreviewElementWithDraggedElement(i,t,r),this.checksElementsUpdates(e,n,i,t,s);this.resetDraggingState(),this.emit("dragEnd")}};replacePreviewElementWithDraggedElement=(t,i,e)=>{t.replaceWith(i),i.setAttribute(this.listIdAttribute,String(t.getAttribute(this.listIdAttribute))),this.draggedElementClass&&L(i,this.draggedElementClass),i.style.cssText=e};checksElementsUpdates=(t,i,e,n,s)=>{let l=Array.from(this.searchListItems(t)).indexOf(n),o=[];if(t.getAttribute(this.listAttribute)!==e.getAttribute(this.previewElementOriginalListAttribute)){let a=Array.from(this.searchListItems(i)),h=Array.from(this.searchListItems(t));o.push(a,h)}else if(l!==s){let a=Array.from(this.searchListItems(t));o.push(a)}o.length>0&&this.emit("itemsUpdated",o)};placeElementToList=(t,i,e)=>{let n=Array.from(this.searchListItems(e)),s=this.previewElementList,r=Array.from(this.searchListItems(s)),l=r.indexOf(t),o=b(r,l,r.length-1);if(n.length===0){this.elementsAnimator.animateElementsMovement(o,()=>{e.insertBefore(t,null),this.savePreviewElPosition(t)}),t.setAttribute(this.listIdAttribute,String(e.getAttribute(this.listAttribute))),this.previewElementList=e;return}let a=c(n[n.length-1]);if(i>a.y+a.h){this.elementsAnimator.animateElementsMovement(o,()=>{e.appendChild(t),this.savePreviewElPosition(t)}),t.setAttribute(this.listIdAttribute,String(e.getAttribute(this.listAttribute))),this.previewElementList=e;return}};replaceElement=(t,i,e)=>{let n=i.parentNode,s=this.searchList(String(i.getAttribute(this.listIdAttribute))),r=Array.from(this.searchListItems(s)),l=r.indexOf(i),o=this.previewElementList,a=Array.from(this.searchListItems(o)),h=a.indexOf(e);if(o.getAttribute(this.listAttribute)!==s.getAttribute(this.listAttribute)){let A=b(a,h,a.length-1),S=b(r,l,r.length-1),M=A.concat(S);this.elementsAnimator.animateElementsMovement(M,()=>{n.insertBefore(e,i),this.savePreviewElPosition(e)}),this.previewElementList=s,e.setAttribute(this.listIdAttribute,String(s.getAttribute(this.listAttribute)));return}let g=i.getBoundingClientRect(),u=g.y+g.height/2,d=b(r,h,l);t>u?l>Number(h)?this.elementsAnimator.animateElementsMovement(d,()=>{n.insertBefore(e,r[l].nextElementSibling),this.savePreviewElPosition(e)}):this.elementsAnimator.animateElementsMovement(d,()=>{n.insertBefore(e,r[l]),this.savePreviewElPosition(e)}):t<u&&(l<Number(h)?this.elementsAnimator.animateElementsMovement(d,()=>{n.insertBefore(e,r[l]),this.savePreviewElPosition(e)}):l>=0&&l<r.length&&this.elementsAnimator.animateElementsMovement(d,()=>{n.insertBefore(e,r[l].nextElementSibling),this.savePreviewElPosition(e)})),e.setAttribute(this.listIdAttribute,String(s.getAttribute(this.listAttribute))),this.previewElementList=s};createDraggedElement=(t,i,e,n)=>{window.getSelection()?.removeAllRanges();let s=i,r=window.getComputedStyle(s),l=parseFloat(r.marginLeft),o=parseFloat(r.marginTop),a=r.getPropertyValue("list-style-type"),h=s.getBoundingClientRect();Object.assign(this.draggedElementPosition,{x:e,y:n,offsetX:e-h.x+l,offsetY:n-h.y+o});let g=Array.from(this.searchListItems(t));this.draggedElementOriginalIndex=g.indexOf(i),s.setAttribute(this.draggedElementAttribute,""),s.setAttribute(this.ignoreElementAttribute,""),this.originalStyle=s.style.cssText;let u=s.getBoundingClientRect();if(s.style.setProperty("width",`${u.width}px`,"important"),s.style.setProperty("height",`${u.height}px`,"important"),s.style.setProperty("z-index","999999","important"),a&&(s.style.listStyleType=a),this.draggedElementStyle)for(let[d,A]of Object.entries(this.draggedElementStyle))s.style.hasOwnProperty(d)&&s.style.setProperty(d,A);return this.draggedElementClass&&f(s,this.draggedElementClass),s.style.position="fixed",s.style.touchAction="none",s.style.pointerEvents="none",s.style.left=String(0),s.style.top=String(0),s.style.transform=`translate(${e-this.draggedElementPosition.offsetX}px, ${n-this.draggedElementPosition.offsetY}px)`,s};createPreviewElement=(t,i)=>{let e=document.createElement("div");e.className=i.className;let n=String(i.getAttribute(this.listIdAttribute)),s=String(t.getAttribute(this.listSharedAttribute));e.setAttribute(this.previewElementOriginalListAttribute,n),e.setAttribute(this.listIdAttribute,n),e.setAttribute(this.previewElementListSharedAttribute,s),e.setAttribute(this.previewElementAttribute,""),this.previewElementList=t,this.previewElementOriginalList=t;let r=getComputedStyle(i),l=["width","height","min-width","min-height","max-width","max-height","padding-top","padding-right","padding-bottom","padding-left","margin-top","margin-right","margin-bottom","margin-left","box-sizing"];for(let o of l)e.style.setProperty(o,r.getPropertyValue(o));if(this.previewElementClass&&f(e,this.previewElementClass),this.previewElementStyle)for(let[o,a]of Object.entries(this.previewElementStyle))e.style.hasOwnProperty(o)&&e.style.setProperty(o,a);return e};resetDraggingState=()=>{this.draggedElement?.removeAttribute(this.draggedElementAttribute),this.draggedElement?.removeAttribute(this.ignoreElementAttribute),this.draggedElement=null,this.draggedElementOriginalIndex=null,this.enteredTarget=null,this.originalStyle="",this.previewElement=null,this.previewElementList=null,this.previewElementOriginalList=null,this.draggedElementPosition={x:0,y:0,offsetX:0,offsetY:0,directionY:0,directionX:0}};updateDraggedElPosition=(t,i,e)=>{t.style.transform=`translate(${i-this.draggedElementPosition.offsetX}px, ${e-this.draggedElementPosition.offsetY}px)`};searchList=t=>document.querySelector(`[${this.listAttribute}="${t}"]`);searchListItems=t=>t.querySelectorAll(`[${this.listItemAttribute}],[${this.previewElementAttribute}]`);savePreviewElPosition=t=>{t.setAttribute(this.previewElementDestinationPositionAttribute,JSON.stringify(c(t)))}};export{y as SimpleDragAndDrop};
